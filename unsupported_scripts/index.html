
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A remote monitoring and management tool">
      
      
        <meta name="author" content="wh1te909">
      
      
        <link rel="canonical" href="https://wh1te909.github.io/tacticalrmm/unsupported_scripts/">
      
      
        <link rel="prev" href="../unsupported_guidelines/">
      
      
        <link rel="next" href="../securing_nginx/">
      
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Unsupported Configs - Tactical RMM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unsupported-reference-scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tactical RMM Documentation" class="md-header__button md-logo" aria-label="Tactical RMM Documentation" data-md-component="logo">
      
  <img src="../images/onit.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tactical RMM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unsupported Configs
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/wh1te909/tacticalrmm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    wh1te909/tacticalrmm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tactical RMM Documentation" class="md-nav__button md-logo" aria-label="Tactical RMM Documentation" data-md-component="logo">
      
  <img src="../images/onit.ico" alt="logo">

    </a>
    Tactical RMM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/wh1te909/tacticalrmm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    wh1te909/tacticalrmm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sponsor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sponsor
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_signing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Signing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    RMM Server Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            RMM Server Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install_considerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Traditional Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install_docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Install
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    RMM Server Updating
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            RMM Server Updating
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Updating the RMM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update_docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Updating the RMM (Docker)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update_agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Updating Agents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Functionality
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Functionality
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howitallworks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How it all Works
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/alerting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alerting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Access
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/automated_tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automated Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/custom_fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Fields
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/database_maintenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/django_admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Django Admin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/keystore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Global Keystore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/maintenance_mode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maintenance Mode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/permissions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Permissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/remote_bg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Background
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/settings_override/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings Override
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/scripting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scripting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/url_actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    URL Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/user_ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Interface Preferences
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../script_variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reference: Script Variables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../backup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../av/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Antivirus Exclusions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../management_cmds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Management Commands
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../mesh_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MeshCentral Integration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3rd Party Integrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            3rd Party Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3rdparty_grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grafana
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3rdparty_anydesk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AnyDesk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3rdparty_screenconnect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectwise Control / Screenconnect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3rdparty_splashtop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Splashtop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3rdparty_teamviewer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TeamViewer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3rdparty_bitdefender_gravityzone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BitDefender GravityZone
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" checked>
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Unsupported Extras
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Unsupported Extras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unsupported_guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unsupported Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Unsupported Configs
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Unsupported Configs
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-notes-on-proxies-and-tactical-rmm" class="md-nav__link">
    <span class="md-ellipsis">
      General Notes on Proxies and Tactical RMM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Notes on Proxies and Tactical RMM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-443" class="md-nav__link">
    <span class="md-ellipsis">
      Port 443
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-4222" class="md-nav__link">
    <span class="md-ellipsis">
      Port 4222
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traefikv2" class="md-nav__link">
    <span class="md-ellipsis">
      Traefikv2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      HAProxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HAProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meshcentral-adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      Meshcentral Adjustment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#haproxy-config" class="md-nav__link">
    <span class="md-ellipsis">
      HAProxy Config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      fail2ban
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fail2ban">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Install fail2ban
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-tactical-fail2ban-filter-conf-file" class="md-nav__link">
    <span class="md-ellipsis">
      Set Tactical fail2ban filter conf File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-tactical-fail2ban-jail-conf-file" class="md-nav__link">
    <span class="md-ellipsis">
      Set Tactical fail2ban jail conf File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Restart fail2ban
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-purchased-ssl-certs-instead-of-letsencrypt-wildcards" class="md-nav__link">
    <span class="md-ellipsis">
      Using purchased SSL certs instead of LetsEncrypt wildcards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-certbot-to-do-acme-challenge-over-http" class="md-nav__link">
    <span class="md-ellipsis">
      Use certbot to do acme challenge over http
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use certbot to do acme challenge over http">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-your-own-certs-with-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Using your own certs with Docker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restricting-access-to-rmmexamplecom" class="md-nav__link">
    <span class="md-ellipsis">
      Restricting Access to rmm.EXAMPLE.COM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restricting Access to rmm.EXAMPLE.COM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Using DNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-fixed-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Using a fixed IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Apache Proxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apache Proxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trmm-server" class="md-nav__link">
    <span class="md-ellipsis">
      TRMM SERVER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache" class="md-nav__link">
    <span class="md-ellipsis">
      APACHE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Updating certificate:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      nginx Proxy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../securing_nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Securing nginx
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unsupported_synology_docker_install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing in Synology docker
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tipsntricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tips n' Tricks
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing to Docs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing_community_scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing to Community Scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing_using_vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing using VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing_using_docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing using Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing_using_a_remote_server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing using a Remote Server
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-notes-on-proxies-and-tactical-rmm" class="md-nav__link">
    <span class="md-ellipsis">
      General Notes on Proxies and Tactical RMM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Notes on Proxies and Tactical RMM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-443" class="md-nav__link">
    <span class="md-ellipsis">
      Port 443
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-4222" class="md-nav__link">
    <span class="md-ellipsis">
      Port 4222
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traefikv2" class="md-nav__link">
    <span class="md-ellipsis">
      Traefikv2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      HAProxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HAProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meshcentral-adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      Meshcentral Adjustment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#haproxy-config" class="md-nav__link">
    <span class="md-ellipsis">
      HAProxy Config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      fail2ban
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fail2ban">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Install fail2ban
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-tactical-fail2ban-filter-conf-file" class="md-nav__link">
    <span class="md-ellipsis">
      Set Tactical fail2ban filter conf File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-tactical-fail2ban-jail-conf-file" class="md-nav__link">
    <span class="md-ellipsis">
      Set Tactical fail2ban jail conf File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Restart fail2ban
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-purchased-ssl-certs-instead-of-letsencrypt-wildcards" class="md-nav__link">
    <span class="md-ellipsis">
      Using purchased SSL certs instead of LetsEncrypt wildcards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-certbot-to-do-acme-challenge-over-http" class="md-nav__link">
    <span class="md-ellipsis">
      Use certbot to do acme challenge over http
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use certbot to do acme challenge over http">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-your-own-certs-with-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Using your own certs with Docker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restricting-access-to-rmmexamplecom" class="md-nav__link">
    <span class="md-ellipsis">
      Restricting Access to rmm.EXAMPLE.COM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restricting Access to rmm.EXAMPLE.COM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Using DNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-fixed-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Using a fixed IP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apache-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Apache Proxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apache Proxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trmm-server" class="md-nav__link">
    <span class="md-ellipsis">
      TRMM SERVER
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache" class="md-nav__link">
    <span class="md-ellipsis">
      APACHE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Updating certificate:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      nginx Proxy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="unsupported-reference-scripts">Unsupported Reference Scripts<a class="headerlink" href="#unsupported-reference-scripts" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are not supported scripts/configurations by Tactical RMM, but it's provided here for your reference.</p>
<p>Although these aren't officially supported configurations, we generally will help point you in the right direction. Please use the Discord <a href="https://discord.com/channels/736478043522072608/888474319750066177">#unsupported channel</a> to discuss issues replated to these complex installations</p>
</div>
<h2 id="general-notes-on-proxies-and-tactical-rmm">General Notes on Proxies and Tactical RMM<a class="headerlink" href="#general-notes-on-proxies-and-tactical-rmm" title="Permanent link">&para;</a></h2>
<h3 id="port-443">Port 443<a class="headerlink" href="#port-443" title="Permanent link">&para;</a></h3>
<p>Make sure websockets option is enabled.</p>
<p>All 3 URL's will need to be configured: <code>rmm</code>, <code>api</code>, <code>mesh</code></p>
<p>For <code>mesh</code> see the Section 10. TLS Offloading of the <a href="https://info.meshcentral.com/downloads/MeshCentral2/MeshCentral2UserGuide.pdf">MeshCentral 2 User Guide</a></p>
<h3 id="port-4222">Port 4222<a class="headerlink" href="#port-4222" title="Permanent link">&para;</a></h3>
<p>Is NATS (<a href="https://nats.io">https://nats.io</a>). You'll need a TCP forwarder as NATS only talks TCP not HTTP.</p>
<h2 id="traefikv2">Traefikv2<a class="headerlink" href="#traefikv2" title="Permanent link">&para;</a></h2>
<p>Offsite Resource: <a href="https://gitlab.com/NiceGuyIT/tactical-goodies/-/tree/main/traefik">https://gitlab.com/NiceGuyIT/tactical-goodies/-/tree/main/traefik</a></p>
<p>This section will assume that by default Traefik will reverse proxy everything on port 443.</p>
<p>Here is a basic Traefik config with docker-composer note the file.directory and file.watch are important.
<div class="highlight"><pre><span></span><code>version:<span class="w"> </span><span class="s2">&quot;3.7&quot;</span>
services:
<span class="w">  </span>traefik:
<span class="w">    </span>container_name:<span class="w"> </span>traefik24
<span class="w">    </span>image:<span class="w"> </span>traefik:v2.4<span class="w"> </span>
<span class="w">    </span>restart:<span class="w"> </span>unless-stopped
<span class="w">    </span>command:
<span class="w">      </span>-<span class="w"> </span>--entryPoints.http.address<span class="o">=</span>:80
<span class="w">      </span>-<span class="w"> </span>--entryPoints.https.address<span class="o">=</span>:443
<span class="w">      </span>-<span class="w"> </span>--providers.docker<span class="o">=</span><span class="nb">true</span>
<span class="w">      </span>-<span class="w"> </span>--providers.docker.endpoint<span class="o">=</span>unix:///var/run/docker.sock
<span class="w">      </span>-<span class="w"> </span>--providers.docker.defaultrule<span class="o">=</span>HostHeader<span class="o">(</span><span class="sb">`</span><span class="o">{{</span><span class="w"> </span>index<span class="w"> </span>.Labels<span class="w"> </span><span class="s2">&quot;com.docker.compose.service&quot;</span><span class="w"> </span><span class="o">}}</span>.<span class="nv">$DOMAINNAME</span><span class="sb">`</span><span class="o">)</span>
<span class="w">      </span><span class="c1">## This is important, to load the config for RMM and Mesh</span>
<span class="w">      </span>-<span class="w"> </span>--providers.file.directory<span class="o">=</span>rules<span class="w"> </span><span class="c1"># Load dynamic configuration from one or more .toml or .yml files in a directory.</span>
<span class="w">      </span>-<span class="w"> </span>--providers.file.watch<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="c1"># Only works on top level files in the rules folder</span>
<span class="w">      </span><span class="c1">####</span>
<span class="w">      </span>-<span class="w"> </span>--certificatesresolvers.dns-cloudflare.acme.dnschallenge<span class="o">=</span><span class="nb">true</span>
<span class="w">      </span>-<span class="w"> </span>--certificatesResolvers.dns-cloudflare.acme.email<span class="o">=</span><span class="nv">$CLOUDFLARE_EMAIL</span>
<span class="w">      </span>-<span class="w"> </span>--certificatesResolvers.dns-cloudflare.acme.storage<span class="o">=</span>/acme.json
<span class="w">      </span>-<span class="w"> </span>--certificatesResolvers.dns-cloudflare.acme.dnsChallenge.provider<span class="o">=</span>cloudflare
<span class="w">      </span>-<span class="w"> </span>--certificatesResolvers.dns-cloudflare.acme.dnsChallenge.resolvers<span class="o">=</span><span class="m">1</span>.1.1.1:53,1.0.0.1:53
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span>target:<span class="w"> </span><span class="m">80</span>
<span class="w">        </span>published:<span class="w"> </span><span class="m">80</span>
<span class="w">        </span>protocol:<span class="w"> </span>tcp
<span class="w">        </span>mode:<span class="w"> </span>host
<span class="w">      </span>-<span class="w"> </span>target:<span class="w"> </span><span class="m">443</span>
<span class="w">        </span>published:<span class="w"> </span><span class="m">443</span>
<span class="w">        </span>protocol:<span class="w"> </span>tcp
<span class="w">        </span>mode:<span class="w"> </span>host
<span class="w">    </span>volumes:
<span class="w">        </span><span class="c1">##The rules that we will load##</span>
<span class="w">      </span>-<span class="w"> </span><span class="nv">$USERDIR</span>/docker/traefik2/rules:/rules<span class="w"> </span>
<span class="w">        </span><span class="c1">##</span>
<span class="w">      </span>-<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock:ro
<span class="w">      </span>-<span class="w"> </span><span class="nv">$USERDIR</span>/docker/traefik2/acme/acme.json:/acme.json
<span class="w">      </span>-<span class="w"> </span><span class="nv">$USERDIR</span>/docker/traefik2/traefik.log:/traefik.log
<span class="w">    </span>environment:
<span class="w">      </span>-<span class="w"> </span><span class="nv">CF_API_EMAIL</span><span class="o">=</span><span class="nv">$CLOUDFLARE_EMAIL</span>
<span class="w">      </span>-<span class="w"> </span><span class="nv">CF_API_KEY</span><span class="o">=</span><span class="nv">$CLOUDFLARE_API_KEY</span>
<span class="w">    </span>labels:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.enable=true&quot;</span>
<span class="w">      </span><span class="c1"># HTTP-to-HTTPS Redirect</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.http-catchall.entrypoints=http&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.http-catchall.rule=HostRegexp(`{host:.+}`)&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.http-catchall.middlewares=redirect-to-https&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https&quot;</span>
<span class="w">      </span><span class="c1"># HTTP Routers</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.traefik-rtr.entrypoints=https&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.traefik-rtr.rule=HostHeader(`traefik.</span><span class="nv">$DOMAINNAME</span><span class="s2">`)&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.traefik-rtr.tls=true&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.traefik-rtr.tls.domains[0].main=</span><span class="nv">$DOMAINNAME</span><span class="s2">&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;traefik.http.routers.traefik-rtr.tls.domains[0].sans=*.</span><span class="nv">$DOMAINNAME</span><span class="s2">&quot;</span>
</code></pre></div></p>
<p>Before proceding, we need to change the port 443 to 4430 and 80 to 800 because the port 443 and 80 are alredy used by Traefik.</p>
<p>Here is a snippet of the only thing you should modify into docker-compose file of the installation.</p>
<p><div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># container for tactical reverse proxy</span>
<span class="w">  </span>tactical-nginx:
<span class="w">    </span>container_name:<span class="w"> </span>trmm-nginx
<span class="w">    </span>image:<span class="w"> </span><span class="si">${</span><span class="nv">IMAGE_REPO</span><span class="si">}</span>tactical-nginx:<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>environment:
<span class="w">      </span>APP_HOST:<span class="w"> </span><span class="si">${</span><span class="nv">APP_HOST</span><span class="si">}</span>
<span class="w">      </span>API_HOST:<span class="w"> </span><span class="si">${</span><span class="nv">API_HOST</span><span class="si">}</span>
<span class="w">      </span>MESH_HOST:<span class="w"> </span><span class="si">${</span><span class="nv">MESH_HOST</span><span class="si">}</span>
<span class="w">      </span>CERT_PUB_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">CERT_PUB_KEY</span><span class="si">}</span>
<span class="w">      </span>CERT_PRIV_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">CERT_PRIV_KEY</span><span class="si">}</span>
<span class="w">    </span>networks:
<span class="w">      </span>proxy:
<span class="w">        </span>ipv4_address:<span class="w"> </span><span class="m">172</span>.20.0.20
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;800:80&quot;</span><span class="w"> </span><span class="c1">## port 800 instead of 80</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;4430:443&quot;</span><span class="w"> </span><span class="c1">## port 4430 instead of 443</span>
</code></pre></div>
Once save, make sure you run the docker-compose or installation script at least once, so all the directory structure are created.
Once you have your certificate (acme.json) generated by traefikv2 we will be able to extract it for rmm.</p>
<p>Copy the acme.json create by traefik into the root of your rmm directory (In my case its $USERDIR/docker/rmm) which you should have already define.
After that we can run this docker to extract the certificates for us.
<div class="highlight"><pre><span></span><code>version:<span class="w"> </span><span class="s2">&quot;3.7&quot;</span>
services:
<span class="c1">##Copy the acme.json of Traefik2 at volumes: (userdir/docker/rmm in this case)</span>
<span class="w">  </span>traefik-certs-dumper:
<span class="w">    </span>image:<span class="w"> </span>ldez/traefik-certs-dumper:v2.7.4
<span class="w">    </span>entrypoint:<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">      apk add jq</span>
<span class="s1">      ; while ! [ -e /data/acme.json ]</span>
<span class="s1">      || ! [ `jq &quot;.[] | .Certificates | length&quot; /data/acme.json` != 0 ]; do</span>
<span class="s1">      sleep 1</span>
<span class="s1">      ; done</span>
<span class="s1">      &amp;&amp; traefik-certs-dumper file --version v2 --watch</span>
<span class="s1">      --source /data/acme.json --dest data/certs&#39;</span>
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="nv">$USERDIR</span>/docker/rmm:/data
</code></pre></div>
Once completed, you should have 1 new folder into you rmm directory $USERDIR/docker/rmm/<strong>certs</strong> in this example.
As the installation instruction, we will pass those to the .env</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;CERT_PUB_KEY=</span><span class="k">$(</span>sudo<span class="w"> </span>base64<span class="w"> </span>-w<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">$USERDIR</span>/docker/rmm/certs/certs/**yourdomaine.com.crt**<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.env
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;CERT_PRIV_KEY=</span><span class="k">$(</span>sudo<span class="w"> </span>base64<span class="w"> </span>-w<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">$USERDIR</span>/docker/rmm/certs/private/**yourdomaine.com.key**<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.env
</code></pre></div>
<p>Next we can create 3 rules to tell traefik to correctly route the https and agent
For that we will create 2 rules into traefik directory as per it configuration. folder/traefik/rules</p>
<p>create 
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>app-mesh.toml
</code></pre></div>
and inside it we add
<div class="highlight"><pre><span></span><code><span class="o">[</span>http.routers<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>http.routers.mesh-rtr<span class="o">]</span>
<span class="w">      </span><span class="nv">entryPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;https&quot;</span><span class="o">]</span>
<span class="w">      </span><span class="nv">rule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Host(`mesh.**yourdomain.com**`)&quot;</span>
<span class="w">      </span><span class="nv">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mesh-svc&quot;</span>
<span class="c1">##middleware with 2fa</span>
<span class="o">[</span>http.services<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>http.services.mesh-svc<span class="o">]</span>
<span class="w">    </span><span class="o">[</span>http.services.mesh-svc.loadBalancer<span class="o">]</span>
<span class="w">      </span><span class="nv">passHostHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">      </span><span class="o">[[</span>http.services.mesh-svc.loadBalancer.servers<span class="o">]]</span>
<span class="w">        </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://**xxx.xxx.xxx.xxx**:4430&quot;</span><span class="w"> </span><span class="c1"># or whatever your external host&#39;s IP is</span>
</code></pre></div></p>
<p>create
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>app-meshagent.toml
</code></pre></div>
and inside it we add</p>
<p><div class="highlight"><pre><span></span><code><span class="o">[</span>http.routers<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>http.routers.mesh-rtr1<span class="o">]</span>
<span class="w">      </span><span class="nv">entryPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;https&quot;</span><span class="o">]</span>
<span class="w">      </span><span class="nv">rule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;Host(`mesh.**yourdomain.com**`) &amp;&amp;</span>
<span class="s2">        PathPrefix( `/agent.ashx`, `/meshrelay.ashx`, ) &amp;&amp;</span>
<span class="s2">        Headers(`X-Forwarded-Proto`, `wss`) &quot;&quot;&quot;</span>
<span class="w">    </span><span class="c1">##Don&#39;t add middle where, the agent wont work.    </span>
<span class="o">[</span>http.services<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>http.services.mesh-svc1<span class="o">]</span>
<span class="w">    </span><span class="o">[</span>http.services.mesh-svc.loadBalancer<span class="o">]</span>
<span class="w">      </span><span class="nv">passHostHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">      </span><span class="o">[[</span>http.services.mesh-svc1.loadBalancer.servers<span class="o">]]</span>
<span class="w">        </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://**xxx.xxx.xxx.xxx**:4430&quot;</span><span class="w"> </span><span class="c1"># or whatever your external host&#39;s IP is</span>
</code></pre></div>
create
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>app-rmm.toml
</code></pre></div>
and inside it we add</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>http.routers<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>http.routers.rmm-rtr<span class="o">]</span>
<span class="w">      </span><span class="nv">entryPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;https&quot;</span><span class="o">]</span>
<span class="w">      </span><span class="nv">rule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Host(`rmm.**yourdomain.com**`)&quot;</span>
<span class="w">      </span><span class="nv">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rmm-svc&quot;</span>

<span class="w">      </span><span class="c1">##middleware with 2fa</span>

<span class="o">[</span>http.services<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>http.services.rmm-svc<span class="o">]</span>
<span class="w">    </span><span class="o">[</span>http.services.rmm-svc.loadBalancer<span class="o">]</span>
<span class="w">      </span><span class="nv">passHostHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">      </span><span class="o">[[</span>http.services.rmm-svc.loadBalancer.servers<span class="o">]]</span>
<span class="w">        </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://xxx.xxx.xxx.xxx:4430&quot;</span><span class="w"> </span><span class="c1"># or whatever your external host&#39;s IP:port is</span>
</code></pre></div>
<p>That it, you can now restart Tactical rmm and mesh.yourdomain.com should work, same for the agent.
Please note that if you have a middleware with 2FA you can still use it with the inside mesh.toml but do not add it with the agent.</p>
<h2 id="haproxy">HAProxy<a class="headerlink" href="#haproxy" title="Permanent link">&para;</a></h2>
<p>Check/Change the mesh central config.json, some of the values may be set already, CertUrl must be changed to point to the HAProxy server.</p>
<h3 id="meshcentral-adjustment">Meshcentral Adjustment<a class="headerlink" href="#meshcentral-adjustment" title="Permanent link">&para;</a></h3>
<p>Credit to <a href="https://github.com/bradhawkins85">@bradhawkins</a></p>
<p>Edit Meshcentral config</p>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>/meshcentral/meshcentral-data/config.json
</code></pre></div>
<p>Insert this (modify <code>HAProxyIP</code> to your network)</p>
<div class="highlight"><pre><span></span><code>{
  &quot;settings&quot;: {
    &quot;Port&quot;: 4430,
    &quot;AliasPort&quot;: 443,
    &quot;RedirPort&quot;: 800,
    &quot;TlsOffload&quot;: &quot;127.0.0.1&quot;,
  },
  &quot;domains&quot;: {
    &quot;&quot;: {
      &quot;CertUrl&quot;: &quot;https://HAProxyIP:443/&quot;,
    }
  }
}
</code></pre></div>
<p>Restart meshcentral</p>
<div class="highlight"><pre><span></span><code>service<span class="w"> </span>meshcentral<span class="w"> </span>restart
</code></pre></div>
<h3 id="haproxy-config">HAProxy Config<a class="headerlink" href="#haproxy-config" title="Permanent link">&para;</a></h3>
<p>The order of use_backend is important <code>Tactical-Mesh-WebSocket_ipvANY</code> must be before <code>Tactical-Mesh_ipvANY</code>
The values of <code>timeout connect</code>, <code>timeout server</code>, <code>timeout tunnel</code> in <code>Tactical-Mesh-WebSocket</code> have been configured to maintain a stable agent connection, however you may need to adjust these values to suit your environment.</p>
<div class="highlight"><pre><span></span><code>frontend HTTPS-merged
    bind            0.0.0.0:443 name 0.0.0.0:443   ssl crt-list /var/etc/haproxy/HTTPS.crt_list  #ADJUST THIS TO YOUR OWN SSL CERTIFICATES
    mode            http
    log         global
    option          socket-stats
    option          dontlognull
    option          http-server-close
    option          forwardfor
    acl https ssl_fc
    http-request set-header     X-Forwarded-Proto http if !https
    http-request set-header     X-Forwarded-Proto https if https
    timeout client      30000
    acl         RMM var(txn.txnhost) -m sub -i rmm.example.com
    acl         aclcrt_RMM  var(txn.txnhost) -m reg -i ^([^\.]*)\.example\.com(:([0-9]){1,5})?$
    acl         API var(txn.txnhost) -m sub -i api.example.com
    acl         aclcrt_API  var(txn.txnhost) -m reg -i ^([^\.]*)\.example\.com(:([0-9]){1,5})?$
    acl         is_websocket    hdr(Upgrade) -i WebSocket
    acl         is_mesh var(txn.txnhost) -m beg -i mesh.example.com
    acl         aclcrt_MESH-WebSocket   var(txn.txnhost) -m reg -i ^([^\.]*)\.example\.com(:([0-9]){1,5})?$
    acl         MESH    var(txn.txnhost) -m sub -i mesh.example.com
    acl         aclcrt_MESH var(txn.txnhost) -m reg -i ^([^\.]*)\.example\.com(:([0-9]){1,5})?$
    #PUT OTHER USE_BACKEND IN HERE
    use_backend Tactical_ipvANY  if  RMM aclcrt_RMM
    use_backend Tactical_ipvANY  if  API aclcrt_API
    use_backend Tactical-Mesh-WebSocket_ipvANY  if  is_websocket is_mesh aclcrt_MESH-WebSocket
    use_backend Tactical-Mesh_ipvANY  if  MESH aclcrt_MESH

frontend http-to-https
    bind            0.0.0.0:80   
    mode            http
    log         global
    option          http-keep-alive
    timeout client      30000
    http-request redirect scheme https 


backend Tactical_ipvANY
    mode            http
    id          100
    log         global
    timeout connect     30000
    timeout server      30000
    retries         3
    option          httpchk GET / 
    server          tactical 192.168.10.123:443 id 101 ssl check inter 1000  verify none 


backend Tactical-Mesh-WebSocket_ipvANY
    mode            http
    id          113
    log         global
    timeout connect     3000
    timeout server      3000
    retries         3
    timeout tunnel      3600000
    http-request add-header X-Forwarded-Host %[req.hdr(Host)] 
    http-request add-header X-Forwarded-Proto https 
    server          tactical 192.168.10.123:443 id 101 ssl  verify none 

backend Tactical-Mesh_ipvANY
    mode            http
    id          112
    log         global
    timeout connect     15000
    timeout server      15000
    retries         3
    option          httpchk GET / 
    timeout tunnel      15000
    http-request add-header X-Forwarded-Host %[req.hdr(Host)] 
    http-request add-header X-Forwarded-Proto https 
    server          tactical 192.168.10.123:443 id 101 ssl check inter 1000  verify none 
</code></pre></div>
<h2 id="fail2ban">fail2ban<a class="headerlink" href="#fail2ban" title="Permanent link">&para;</a></h2>
<h3 id="install-fail2ban">Install fail2ban<a class="headerlink" href="#install-fail2ban" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>fail2ban
</code></pre></div>
<h3 id="set-tactical-fail2ban-filter-conf-file">Set Tactical fail2ban filter conf File<a class="headerlink" href="#set-tactical-fail2ban-filter-conf-file" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">tacticalfail2banfilter</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">[Definition]</span>
<span class="s">failregex = ^&lt;HOST&gt;.*400.17.*$</span>
<span class="s">ignoreregex = ^&lt;HOST&gt;.*200.*$</span>
<span class="s">EOF</span>
<span class="k">)</span><span class="s2">&quot;</span>
sudo<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">tacticalfail2banfilter</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/fail2ban/filter.d/tacticalrmm.conf
</code></pre></div>
<h3 id="set-tactical-fail2ban-jail-conf-file">Set Tactical fail2ban jail conf File<a class="headerlink" href="#set-tactical-fail2ban-jail-conf-file" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">tacticalfail2banjail</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">[tacticalrmm]</span>
<span class="s">enabled = true</span>
<span class="s">port = 80,443</span>
<span class="s">filter = tacticalrmm</span>
<span class="s">action = iptables-allports[name=tactical]</span>
<span class="s">logpath = /rmm/api/tacticalrmm/tacticalrmm/private/log/access.log</span>
<span class="s">maxretry = 3</span>
<span class="s">bantime = 14400</span>
<span class="s">findtime = 14400</span>
<span class="s">EOF</span>
<span class="k">)</span><span class="s2">&quot;</span>
sudo<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">tacticalfail2banjail</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/fail2ban/jail.d/tacticalrmm.local
</code></pre></div>
<h3 id="restart-fail2ban">Restart fail2ban<a class="headerlink" href="#restart-fail2ban" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>fail2ban
</code></pre></div>
<h2 id="using-purchased-ssl-certs-instead-of-letsencrypt-wildcards">Using purchased SSL certs instead of LetsEncrypt wildcards<a class="headerlink" href="#using-purchased-ssl-certs-instead-of-letsencrypt-wildcards" title="Permanent link">&para;</a></h2>
<p>Credit to <a href="https://github.com/dinger1986">@dinger1986</a></p>
<p>How to change certs used by Tactical RMM to purchased ones (this can be a wildcard cert).</p>
<p>You need to add the certificate private key and public keys to the following files:</p>
<p><code>/etc/nginx/sites-available/rmm.conf</code></p>
<p><code>/etc/nginx/sites-available/meshcentral.conf</code></p>
<p><code>/etc/nginx/sites-available/frontend.conf</code></p>
<p><code>/rmm/api/tacticalrmm/tacticalrmm/local_settings.py</code></p>
<ol>
<li>
<p>create a new folder for certs and allow tactical user permissions (assumed to be tactical)</p>
<div class="codehilite"><pre><span></span><code>sudo mkdir /certs
sudo chown -R tactical:tactical /certs&quot;
</code></pre></div>

</li>
<li>
<p>Now move your certs into that folder.</p>
</li>
<li>
<p>Open the api file and add the api certificate or if its a wildcard the directory should be <code>/certs/EXAMPLE.COM/</code></p>
<div class="codehilite"><pre><span></span><code>sudo nano /etc/nginx/sites-available/rmm.conf
</code></pre></div>

<p>replace   </p>
<div class="codehilite"><pre><span></span><code>ssl_certificate /etc/letsencrypt/live/EXAMPLE.COM/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/EXAMPLE.COM/privkey.pem;
</code></pre></div>

<p>with</p>
<div class="codehilite"><pre><span></span><code>ssl_certificate /certs/api.EXAMPLE.COM/fullchain.pem;
ssl_certificate_key /certs/api.EXAMPLE.COM/privkey.pem;
</code></pre></div>

</li>
<li>
<p>Repeat the process for </p>
<div class="codehilite"><pre><span></span><code>/etc/nginx/sites-available/meshcentral.conf
/etc/nginx/sites-available/frontend.conf
</code></pre></div>

<p>but change api. to: mesh. and rmm. respectively.</p>
</li>
<li>
<p>Add the following to the last lines of <code>/rmm/api/tacticalrmm/tacticalrmm/local_settings.py</code></p>
<div class="codehilite"><pre><span></span><code>nano /rmm/api/tacticalrmm/tacticalrmm/local_settings.py
</code></pre></div>

<p>add</p>
<div class="codehilite"><pre><span></span><code>CERT_FILE = &quot;/certs/api.EXAMPLE.COM/fullchain.pem&quot;
KEY_FILE = &quot;/certs/api.EXAMPLE.COM/privkey.pem&quot;
</code></pre></div>

</li>
<li>
<p>Regenerate Nats Conf</p>
<div class="codehilite"><pre><span></span><code>cd /rmm/api/tacticalrmm
source ../env/bin/activate
python manage.py reload_nats
</code></pre></div>

</li>
<li>
<p>Restart services</p>
<div class="codehilite"><pre><span></span><code>sudo systemctl restart rmm celery celerybeat nginx nats nats-api
</code></pre></div>

</li>
</ol>
<h2 id="use-certbot-to-do-acme-challenge-over-http">Use certbot to do acme challenge over http<a class="headerlink" href="#use-certbot-to-do-acme-challenge-over-http" title="Permanent link">&para;</a></h2>
<p>The standard SSL cert process in Tactical uses a <a href="https://letsencrypt.org/docs/challenge-types/#dns-01-challenge">DNS challenge</a> that requires dns txt files to be updated in your public DNS with every cert renewal.</p>
<p>The below script uses <a href="https://letsencrypt.org/docs/challenge-types/#http-01-challenge">http challenge</a> on the 3 separate ssl certs, one for each subdomain: rmm, api, mesh. They still have the same 3 month expiry. Restart the Tactical RMM server about every 2.5 months (80 days) for auto-renewed certs to become active.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your Tactical RMM server will need to have TCP Port: 80 exposed to the internet</p>
</div>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">###Set colours same as Tactical RMM install and Update</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>

<span class="c1">### Ubuntu 20.04 Check</span>

<span class="nv">UBU20</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="m">20</span>.04<span class="w"> </span><span class="s2">&quot;/etc/&quot;</span>*<span class="s2">&quot;release&quot;</span><span class="k">)</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$UBU20</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;\033[0;31mThis script will only work on Ubuntu 20.04\e[0m\n&quot;</span>
<span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

cls<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;\033c&quot;</span>
<span class="o">}</span>

print_green<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="nb">printf</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">%0.s-</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..80<span class="o">}</span>
<span class="w">  </span><span class="nb">printf</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;\n&quot;</span>
<span class="w">  </span><span class="nb">printf</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}${</span><span class="nv">1</span><span class="si">}${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">\n&quot;</span>
<span class="w">  </span><span class="nb">printf</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">%0.s-</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..80<span class="o">}</span>
<span class="w">  </span><span class="nb">printf</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;\n&quot;</span>
<span class="o">}</span>

cls

<span class="c1">### Set variables for domains</span>

<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$rmmdomain</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>*<span class="o">[</span>.<span class="o">]</span>*<span class="o">[</span>.<span class="o">]</span>*<span class="w"> </span><span class="o">]]</span>
<span class="k">do</span>
<span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Enter the subdomain used for the backend (e.g. api.example.com)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">: &quot;</span>
<span class="nb">read</span><span class="w"> </span>rmmdomain
<span class="k">done</span>

<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$frontenddomain</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>*<span class="o">[</span>.<span class="o">]</span>*<span class="o">[</span>.<span class="o">]</span>*<span class="w"> </span><span class="o">]]</span>
<span class="k">do</span>
<span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Enter the subdomain used for the frontend (e.g. rmm.example.com)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">: &quot;</span>
<span class="nb">read</span><span class="w"> </span>frontenddomain
<span class="k">done</span>

<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$meshdomain</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>*<span class="o">[</span>.<span class="o">]</span>*<span class="o">[</span>.<span class="o">]</span>*<span class="w"> </span><span class="o">]]</span>
<span class="k">do</span>
<span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Enter the subdomain used for meshcentral (e.g. mesh.example.com)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">: &quot;</span>
<span class="nb">read</span><span class="w"> </span>meshdomain
<span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Enter the current root domain (e.g. example.com or example.co.uk)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">: &quot;</span>
<span class="nb">read</span><span class="w"> </span>rootdomain


<span class="c1">### Setup Certificate Variables</span>
<span class="nv">CERT_PRIV_KEY</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">rootdomain</span><span class="si">}</span>/privkey.pem
<span class="nv">CERT_PUB_KEY</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">rootdomain</span><span class="si">}</span>/fullchain.pem

<span class="c1">### Make Letsencrypt directories</span>

sudo<span class="w"> </span>mkdir<span class="w"> </span>/var/www/letsencrypt
sudo<span class="w"> </span>mkdir<span class="w"> </span>/var/www/letsencrypt/.mesh
sudo<span class="w"> </span>mkdir<span class="w"> </span>/var/www/letsencrypt/.rmm
sudo<span class="w"> </span>mkdir<span class="w"> </span>/var/www/letsencrypt/.api

<span class="c1">### Remove config files for nginx</span>

sudo<span class="w"> </span>rm<span class="w"> </span>/etc/nginx/sites-available/rmm.conf
sudo<span class="w"> </span>rm<span class="w"> </span>/etc/nginx/sites-available/meshcentral.conf
sudo<span class="w"> </span>rm<span class="w"> </span>/etc/nginx/sites-available/frontend.conf
sudo<span class="w"> </span>rm<span class="w"> </span>/etc/nginx/sites-enabled/rmm.conf
sudo<span class="w"> </span>rm<span class="w"> </span>/etc/nginx/sites-enabled/meshcentral.conf
sudo<span class="w"> </span>rm<span class="w"> </span>/etc/nginx/sites-enabled/frontend.conf

<span class="c1">### Setup tactical nginx config files for letsencrypt</span>

<span class="nv">nginxrmm</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">server_tokens off;</span>
<span class="s">upstream tacticalrmm {</span>
<span class="s">    server unix:////rmm/api/tacticalrmm/tacticalrmm.sock;</span>
<span class="s">}</span>
<span class="s">map \$http_user_agent \$ignore_ua {</span>
<span class="s">    &quot;~python-requests.*&quot; 0;</span>
<span class="s">    &quot;~go-resty.*&quot; 0;</span>
<span class="s">    default 1;</span>
<span class="s">}</span>
<span class="s">server {</span>
<span class="s">    listen 80;</span>
<span class="s">    server_name ${rmmdomain};</span>
<span class="s">        location /.well-known/acme-challenge/ {</span>
<span class="s">        root /var/www/letsencrypt/.api/;}</span>
<span class="s">    location / {</span>
<span class="s">    return 301 https://\$server_name\$request_uri;}</span>
<span class="s">}</span>
<span class="s">server {</span>
<span class="s">    listen 443 ssl;</span>
<span class="s">    server_name ${rmmdomain};</span>
<span class="s">    client_max_body_size 300M;</span>
<span class="s">    access_log /rmm/api/tacticalrmm/tacticalrmm/private/log/access.log;</span>
<span class="s">    error_log /rmm/api/tacticalrmm/tacticalrmm/private/log/error.log;</span>
<span class="s">    ssl_certificate ${CERT_PUB_KEY};</span>
<span class="s">    ssl_certificate_key ${CERT_PRIV_KEY};</span>
<span class="s">    ssl_ciphers &#39;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&#39;;</span>

<span class="s">    location /static/ {</span>
<span class="s">        root /rmm/api/tacticalrmm;</span>
<span class="s">    }</span>
<span class="s">    location /private/ {</span>
<span class="s">        internal;</span>
<span class="s">        add_header &quot;Access-Control-Allow-Origin&quot; &quot;https://${frontenddomain}&quot;;</span>
<span class="s">        alias /rmm/api/tacticalrmm/tacticalrmm/private/;</span>
<span class="s">    }</span>
<span class="s">location ~ ^/ws/ {</span>
<span class="s">        proxy_pass http://unix:/rmm/daphne.sock;</span>
<span class="s">        proxy_http_version 1.1;</span>
<span class="s">        proxy_set_header Upgrade $http_upgrade;</span>
<span class="s">        proxy_set_header Connection &quot;upgrade&quot;;</span>
<span class="s">        proxy_redirect     off;</span>
<span class="s">        proxy_set_header   Host $host;</span>
<span class="s">        proxy_set_header   X-Real-IP $remote_addr;</span>
<span class="s">        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;</span>
<span class="s">        proxy_set_header   X-Forwarded-Host $server_name;</span>
<span class="s">}</span>
<span class="s">    location /saltscripts/ {</span>
<span class="s">        internal;</span>
<span class="s">        add_header &quot;Access-Control-Allow-Origin&quot; &quot;https://${frontenddomain}&quot;;</span>
<span class="s">        alias /srv/salt/scripts/userdefined/;</span>
<span class="s">    }</span>
<span class="s">    location /builtin/ {</span>
<span class="s">        internal;</span>
<span class="s">        add_header &quot;Access-Control-Allow-Origin&quot; &quot;https://${frontenddomain}&quot;;</span>
<span class="s">        alias /srv/salt/scripts/;</span>
<span class="s">    }</span>
<span class="s">    location ~ ^/(natsapi) {</span>
<span class="s">        allow 127.0.0.1;</span>
<span class="s">        deny all;</span>
<span class="s">        uwsgi_pass tacticalrmm;</span>
<span class="s">        include     /etc/nginx/uwsgi_params;</span>
<span class="s">        uwsgi_read_timeout 500s;</span>
<span class="s">        uwsgi_ignore_client_abort on;</span>
<span class="s">    }</span>
<span class="s">    location / {</span>
<span class="s">        uwsgi_pass  tacticalrmm;</span>
<span class="s">        include     /etc/nginx/uwsgi_params;</span>
<span class="s">        uwsgi_read_timeout 9999s;</span>
<span class="s">        uwsgi_ignore_client_abort on;</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>
<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">nginxrmm</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/nginx/sites-available/rmm.conf<span class="w"> </span>&gt;<span class="w"> </span>/dev/null


<span class="nv">nginxmesh</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">server {</span>
<span class="s">  listen 80;</span>
<span class="s">  server_name ${meshdomain};</span>
<span class="s">      location /.well-known/acme-challenge/ {</span>
<span class="s">        root /var/www/letsencrypt/.mesh/;}</span>
<span class="s">    location / {</span>
<span class="s">  return 301 https://\$server_name\$request_uri;}</span>
<span class="s">}</span>
<span class="s">server {</span>
<span class="s">    listen 443 ssl;</span>
<span class="s">    proxy_send_timeout 330s;</span>
<span class="s">    proxy_read_timeout 330s;</span>
<span class="s">    server_name ${meshdomain};</span>
<span class="s">    ssl_certificate ${CERT_PUB_KEY};</span>
<span class="s">    ssl_certificate_key ${CERT_PRIV_KEY};</span>
<span class="s">    ssl_session_cache shared:WEBSSL:10m;</span>
<span class="s">    ssl_ciphers HIGH:!aNULL:!MD5;</span>
<span class="s">    ssl_prefer_server_ciphers on;</span>
<span class="s">    location / {</span>
<span class="s">        proxy_pass http://127.0.0.1:4430/;</span>
<span class="s">        proxy_http_version 1.1;</span>
<span class="s">        proxy_set_header Host \$host;</span>
<span class="s">        proxy_set_header Upgrade \$http_upgrade;</span>
<span class="s">        proxy_set_header Connection &quot;upgrade&quot;;</span>
<span class="s">        proxy_set_header X-Forwarded-Host \$host:\$server_port;</span>
<span class="s">        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;</span>
<span class="s">        proxy_set_header X-Forwarded-Proto \$scheme;</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>
<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">nginxmesh</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/nginx/sites-available/meshcentral.conf<span class="w"> </span>&gt;<span class="w"> </span>/dev/null



<span class="nv">nginxfrontend</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">server {</span>
<span class="s">    server_name ${frontenddomain};</span>
<span class="s">    charset utf-8;</span>
<span class="s">    location / {</span>
<span class="s">        root /var/www/rmm/dist;</span>
<span class="s">        try_files \$uri \$uri/ /index.html;</span>
<span class="s">        add_header Cache-Control &quot;no-store, no-cache, must-revalidate&quot;;</span>
<span class="s">        add_header Pragma &quot;no-cache&quot;;</span>
<span class="s">    }</span>
<span class="s">    error_log  /var/log/nginx/frontend-error.log;</span>
<span class="s">    access_log /var/log/nginx/frontend-access.log;</span>
<span class="s">    listen 443 ssl;</span>
<span class="s">    ssl_certificate ${CERT_PUB_KEY};</span>
<span class="s">    ssl_certificate_key ${CERT_PRIV_KEY};</span>
<span class="s">    ssl_ciphers &#39;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&#39;;</span>
<span class="s">}</span>
<span class="s">server {</span>
<span class="s">    listen 80;</span>
<span class="s">    server_name ${frontenddomain};</span>
<span class="s">    location /.well-known/acme-challenge/ {</span>
<span class="s">        root /var/www/letsencrypt/.rmm/;}</span>
<span class="s">    location / {</span>
<span class="s">    return 301 https://\$host\$request_uri;}</span>
<span class="s">}</span>
<span class="s">EOF</span>
<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">nginxfrontend</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/nginx/sites-available/frontend.conf<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1">### Relink nginx config files</span>

sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/rmm.conf<span class="w"> </span>/etc/nginx/sites-enabled/rmm.conf
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/meshcentral.conf<span class="w"> </span>/etc/nginx/sites-enabled/meshcentral.conf
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/frontend.conf<span class="w"> </span>/etc/nginx/sites-enabled/frontend.conf

<span class="c1">### Restart nginx</span>

sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx


<span class="c1">### Get letsencrypt Certs</span>

sudo<span class="w"> </span>letsencrypt<span class="w"> </span>certonly<span class="w"> </span>--webroot<span class="w"> </span>-w<span class="w"> </span>/var/www/letsencrypt/.mesh/<span class="w"> </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">meshdomain</span><span class="si">}</span>
sudo<span class="w"> </span>letsencrypt<span class="w"> </span>certonly<span class="w"> </span>--webroot<span class="w"> </span>-w<span class="w"> </span>/var/www/letsencrypt/.rmm/<span class="w"> </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">frontenddomain</span><span class="si">}</span>
sudo<span class="w"> </span>letsencrypt<span class="w"> </span>certonly<span class="w"> </span>--webroot<span class="w"> </span>-w<span class="w"> </span>/var/www/letsencrypt/.api/<span class="w"> </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">rmmdomain</span><span class="si">}</span>

<span class="c1">### Ensure letsencrypt Permissions are correct</span>
sudo<span class="w"> </span>chown<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span><span class="w"> </span>-R<span class="w"> </span>/etc/letsencrypt
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span>-R<span class="w"> </span>/etc/letsencrypt

<span class="c1">### Set variables for new certs</span>

<span class="nv">CERT_PRIV_KEY_API</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">rmmdomain</span><span class="si">}</span>/privkey.pem
<span class="nv">CERT_PUB_KEY_API</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">rmmdomain</span><span class="si">}</span>/fullchain.pem
<span class="nv">CERT_PRIV_KEY_RMM</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">frontenddomain</span><span class="si">}</span>/privkey.pem
<span class="nv">CERT_PUB_KEY_RMM</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">frontenddomain</span><span class="si">}</span>/fullchain.pem
<span class="nv">CERT_PRIV_KEY_MESH</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">meshdomain</span><span class="si">}</span>/privkey.pem
<span class="nv">CERT_PUB_KEY_MESH</span><span class="o">=</span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">meshdomain</span><span class="si">}</span>/fullchain.pem

<span class="c1">### Replace certs in files</span>

<span class="nv">rmmlocalsettings</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">CERT_FILE = &quot;${CERT_PUB_KEY_API}&quot;</span>
<span class="s">KEY_FILE = &quot;${CERT_PRIV_KEY_API}&quot;</span>
<span class="s">EOF</span>
<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">rmmlocalsettings</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>--append<span class="w"> </span>/rmm/api/tacticalrmm/tacticalrmm/local_settings.py<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|</span><span class="si">${</span><span class="nv">CERT_PRIV_KEY</span><span class="si">}</span><span class="s2">|</span><span class="si">${</span><span class="nv">CERT_PRIV_KEY_API</span><span class="si">}</span><span class="s2">|g&quot;</span><span class="w"> </span>/etc/nginx/sites-available/rmm.conf
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|</span><span class="si">${</span><span class="nv">CERT_PUB_KEY</span><span class="si">}</span><span class="s2">|</span><span class="si">${</span><span class="nv">CERT_PUB_KEY_API</span><span class="si">}</span><span class="s2">|g&quot;</span><span class="w"> </span>/etc/nginx/sites-available/rmm.conf
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|</span><span class="si">${</span><span class="nv">CERT_PRIV_KEY</span><span class="si">}</span><span class="s2">|</span><span class="si">${</span><span class="nv">CERT_PRIV_KEY_MESH</span><span class="si">}</span><span class="s2">|g&quot;</span><span class="w"> </span>/etc/nginx/sites-available/meshcentral.conf
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|</span><span class="si">${</span><span class="nv">CERT_PUB_KEY</span><span class="si">}</span><span class="s2">|</span><span class="si">${</span><span class="nv">CERT_PUB_KEY_MESH</span><span class="si">}</span><span class="s2">|g&quot;</span><span class="w"> </span>/etc/nginx/sites-available/meshcentral.conf
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|</span><span class="si">${</span><span class="nv">CERT_PRIV_KEY</span><span class="si">}</span><span class="s2">|</span><span class="si">${</span><span class="nv">CERT_PRIV_KEY_RMM</span><span class="si">}</span><span class="s2">|g&quot;</span><span class="w"> </span>/etc/nginx/sites-available/frontend.conf
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s|</span><span class="si">${</span><span class="nv">CERT_PUB_KEY</span><span class="si">}</span><span class="s2">|</span><span class="si">${</span><span class="nv">CERT_PUB_KEY_RMM</span><span class="si">}</span><span class="s2">|g&quot;</span><span class="w"> </span>/etc/nginx/sites-available/frontend.conf

<span class="c1">### Remove Wildcard Cert</span>

rm<span class="w"> </span>-r<span class="w"> </span>/etc/letsencrypt/live/<span class="si">${</span><span class="nv">rootdomain</span><span class="si">}</span>/
rm<span class="w"> </span>-r<span class="w"> </span>/etc/letsencrypt/archive/<span class="si">${</span><span class="nv">rootdomain</span><span class="si">}</span>/
rm<span class="w"> </span>/etc/letsencrypt/renewal/<span class="si">${</span><span class="nv">rootdomain</span><span class="si">}</span>.conf


<span class="c1">### Regenerate Nats Conf</span>
<span class="nb">cd</span><span class="w"> </span>/rmm/api/tacticalrmm
<span class="nb">source</span><span class="w"> </span>../env/bin/activate
python<span class="w"> </span>manage.py<span class="w"> </span>reload_nats

<span class="c1">### Restart services</span>

<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>rmm<span class="w"> </span>celery<span class="w"> </span>celerybeat<span class="w"> </span>nginx<span class="w"> </span>nats<span class="w"> </span>nats-api
<span class="k">do</span>
<span class="nb">printf</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Restarting </span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2"> service...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">\n&quot;</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span><span class="si">${</span><span class="nv">i</span><span class="si">}</span>
<span class="k">done</span>


<span class="c1">###Renew certs can be done by sudo letsencrypt renew (this should automatically be in /etc/cron.d/certbot)</span>
</code></pre></div>
<h3 id="using-your-own-certs-with-docker">Using your own certs with Docker<a class="headerlink" href="#using-your-own-certs-with-docker" title="Permanent link">&para;</a></h3>
<p>Let's Encrypt is the only officially supported method of obtaining wildcard certificates. Publicly signed certificates should work but have not been fully tested.</p>
<p>If you are providing your own publicly signed certificates, ensure you download the <strong>full chain</strong> (combined CA/Root + Intermediary) certificate in pem format. If certificates are not provided, a self-signed certificate will be generated and most agent functions won't work.</p>
<h2 id="restricting-access-to-rmmexamplecom">Restricting Access to rmm.EXAMPLE.COM<a class="headerlink" href="#restricting-access-to-rmmexamplecom" title="Permanent link">&para;</a></h2>
<p>Limit access to Tactical RMM's administration panel in nginx to specific locations</p>
<h3 id="using-dns">Using DNS<a class="headerlink" href="#using-dns" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create a file allowed-domain.list which contains the DNS names you want to grant access to your rmm:</p>
<p>Edit <code>/etc/nginx/allowed-domain.list</code> and add</p>
<div class="codehilite"><pre><span></span><code>nom1.dyndns.tv
nom2.dyndns.tv
</code></pre></div>

</li>
<li>
<p>Create a bash script domain-resolver.sh which do the DNS lookups for you:</p>
<p>Edit <code>/etc/nginx/domain-resolver.sh</code></p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>
<span class="nv">filename</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line
<span class="k">do</span>
<span class="w">        </span><span class="nv">ddns_record</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w">  </span>-z<span class="w">  </span><span class="nv">$ddns_record</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nv">resolved_ip</span><span class="o">=</span>getent<span class="w"> </span>ahosts<span class="w"> </span><span class="nv">$line</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ print $1 ; exit }&#39;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w">  </span>-z<span class="w">  </span><span class="nv">$resolved_ip</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;allow </span><span class="nv">$resolved_ip</span><span class="s2">;# from </span><span class="nv">$ddns_record</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>Give the right permission to this script <code>chmod +x /etc/nginx/domain-resolver.sh</code></p>
</li>
<li>
<p>Add a cron job which produces a valid nginx configuration and restarts nginx:</p>
<p><code>/etc/cron.hourly/domain-resolver</code></p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>
/etc/nginx/domain-resolver.sh<span class="w"> </span>/etc/nginx/allowed-domain.list<span class="w"> </span>&gt;<span class="w"> </span>/etc/nginx//allowed-ips-from-domains.conf
service<span class="w"> </span>nginx<span class="w"> </span>reload<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</code></pre></div></td></tr></table></div>

<p>This can be a hourly, daily or monthly job or you can have it run at a specific time. </p>
</li>
<li>
<p>Give the right permission to this script chmod +x /etc/cron.hourly/domain-resolver</p>
</li>
<li>
<p>When run it will give something like this</p>
<p>Edit <code>/etc/nginx//allowed-ips-from-domains.conf</code></p>
<div class="codehilite"><pre><span></span><code>allow xxx.xxx.xxx.xxx;# from maison.nom1.dyndns.tv
allow xxx.xxx.xxx.xxx;# from maison.nom2.dyndns.tv
</code></pre></div>

</li>
<li>
<p>Update your nginx configuration to take this output into account:</p>
<p>Edit <code>/etc/nginx/sites-enabled/frontend.conf</code></p>
<div class="codehilite"><pre><span></span><code>server {
    server_name rmm.example.com;
    charset utf-8;
    location / {
        root /var/www/rmm/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control &quot;no-store, no-cache, must-revalidate&quot;;
        add_header Pragma &quot;no-cache&quot;;
    }
    error_log  /var/log/nginx/frontend-error.log;
    access_log /var/log/nginx/frontend-access.log;
    include /etc/nginx/allowed-ips-from-domains.conf;
    deny all;
    listen 443 ssl;
    listen [::]:443 ssl;
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    ssl_ciphers &#39;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&#39;;
}

server {
    if ($host = rmm.example.com) {
        return 301 https://$host$request_uri;
    }

    listen 80;
    listen [::]:80;
    server_name rmm.example.com;
    return 404;
}
</code></pre></div>

</li>
</ol>
<h3 id="using-a-fixed-ip">Using a fixed IP<a class="headerlink" href="#using-a-fixed-ip" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create a file containg the fixed IP address (where xxx.xxx.xxx.xxx must be replaced by your real IP address)</p>
<p>Edit <code>/etc/nginx//allowed-ips.conf</code></p>
<div class="codehilite"><pre><span></span><code># Private IP address
allow 192.168.0.0/16;
allow 172.16.0.0/12;
allow 10.0.0.0/8;
# Public fixed IP address
allow xxx.xxx.xxx.xxx
</code></pre></div>

</li>
<li>
<p>Update your nginx configuration to take this output into account:</p>
<p>Edit <code>/etc/nginx/sites-enabled/frontend.conf</code></p>
<div class="codehilite"><pre><span></span><code>server {
    server_name rmm.example.com;
    charset utf-8;
    location / {
        root /var/www/rmm/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control &quot;no-store, no-cache, must-revalidate&quot;;
        add_header Pragma &quot;no-cache&quot;;
    }
    error_log  /var/log/nginx/frontend-error.log;
    access_log /var/log/nginx/frontend-access.log;
include /etc/nginx/allowed-ips;
    deny all;
    listen 443 ssl;
    listen [::]:443 ssl;
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    ssl_ciphers &#39;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&#39;;
}

server {
    if ($host = rmm.example.com) {
        return 301 https://$host$request_uri;
    }

    listen 80;
    listen [::]:80;
    server_name rmm.example.com;
    return 404;
}
</code></pre></div>

</li>
</ol>
<h2 id="apache-proxy">Apache Proxy<a class="headerlink" href="#apache-proxy" title="Permanent link">&para;</a></h2>
<p>howto -  proxy on apache</p>
<h3 id="trmm-server">TRMM SERVER<a class="headerlink" href="#trmm-server" title="Permanent link">&para;</a></h3>
<p>edit file /etc/nginx/sites-available/rmm.conf
add the lines from 'real_ip' module inside server tag:</p>
<div class="codehilite"><pre><span></span><code>set_real_ip_from    192.168.0.200; #IP Address of your apache proxy
real_ip_header      X-Forwarded-For;
</code></pre></div>

<p>restart nginx</p>
<div class="codehilite"><pre><span></span><code>systemctl restart nginx
</code></pre></div>

<h3 id="apache">APACHE<a class="headerlink" href="#apache" title="Permanent link">&para;</a></h3>
<p>enable ssl proxy, rewriteEngine. 
set proxy to preserve host.
set upgrade rule to websocket.
set proxypass rules redirecting to rmm location</p>
<p>on your apache ssl config
example:</p>
<div class="codehilite"><pre><span></span><code>&lt;VirtualHost *:443&gt;
    ServerName rmm.blablabla.com.br:443
    ServerAlias mesh.blablabla.com.br:443 api.blablabla.com.br:443 
    SSLEngine on

    SSLCertificateFile &quot;C:/Apache24/conf/ssl-rmm.blablabla.com.br/_.blablabla.com.br-chain.pem&quot;
    SSLCertificateKeyFile &quot;C:/Apache24/conf/ssl-rmm.blablabla.com.br/_.blablabla.com.br-key.pem&quot;

    SSLProxyEngine on

    RewriteEngine On
    ProxyPreserveHost On

    # When Upgrade:websocket header is present, redirect to ws
    # Using NC flag (case-insensitive) as some browsers will pass Websocket
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule ^/(.*)    wss://192.168.0.212/$1 [P,L]

    ProxyPass &quot;/&quot;  &quot;https://192.168.0..212/&quot; retry=3
    ProxyPassReverse &quot;/&quot;  &quot;https://192.168.0.212/&quot; retry=3

    BrowserMatch &quot;MSIE [2-5]&quot; \
             nokeepalive ssl-unclean-shutdown \
             downgrade-1.0 force-response-1.0
</code></pre></div>

<p></VirtualHost></p>
<h3 id="updating-certificate">Updating certificate:<a class="headerlink" href="#updating-certificate" title="Permanent link">&para;</a></h3>
<p>Im my case, auto DNS Challenge from apache, so every time we get new cert files, it must be copied inside rmm too.
just overwrite default location:
/etc/letsencrypt/archive/blablablabla
or change certs location on nginx conf to whatever you want.</p>
<h2 id="nginx-proxy">nginx Proxy<a class="headerlink" href="#nginx-proxy" title="Permanent link">&para;</a></h2>
<p>Having mesh connection issues? </p>
<p>See <a href="https://info.meshcentral.com/downloads/MeshCentral2/MeshCentral2UserGuide.pdf">https://info.meshcentral.com/downloads/MeshCentral2/MeshCentral2UserGuide.pdf</a> page 30.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/wh1te909/tacticalrmm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>